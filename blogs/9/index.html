
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>更多关于 External component & Data synchronization - 空气胶囊</title>
  <meta name="author" content="Liy">

  
  <meta name="description" content="Access ModelDescription OpenAny entity may subscribe to the node (i.e., without the necessity for subscription approval) and any entity may retrieve &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://aircapsule.com/blogs/9">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="空气胶囊" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-38976134-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">空气胶囊</a></h1>
  
    <h2>程序杀手一枚</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:aircapsule.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">更多关于 External Component & Data Synchronization</h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-03-25T00:00:00+00:00" pubdate data-updated="true">Mar 25<span>th</span>, 2009</time>
        
         | <a href="#disqus_thread">Comments</a>
        
      </p>
    
  </header>


<div class="entry-content"><div id="msgcns!657528B8E1B18FB4!1904" class="bvMsg"><blockquote> <p><font size="1">Access Model<br />Description</font>  <p><font size="1">Open<br />Any entity may subscribe to the node (i.e., without the necessity for subscription approval) and any entity may retrieve items from the node (i.e., without being subscribed); this SHOULD be the default access model for generic pubsub services.</font>  <p><font size="1">Presence<br />Any entity with a subscription of type &quot;from&quot; or &quot;both&quot; may subscribe to the node and retrieve items from the node; this access model applies mainly to instant messaging systems (see RFC 3921).</font>  <p><font size="1">Roster<br />Any entity in the specified roster group(s) may subscribe to the node and retrieve items from the node; this access model applies mainly to instant messaging systems (see RFC 3921).</font>  <p><font size="1">Authorize<br />The node owner must approve all subscription requests, and only subscribers may retrieve items from the node.</font>  <p><font size="1">Whitelist<br />An entity may subscribe or retrieve items only if on a whitelist managed by the node owner. The node owner MUST automatically be on the whitelist. In order to add entities to the whitelist, the node owner SHOULD use the protocol specified in the </font><a href="http://xmpp.org/#owner-affiliations"><font size="1">Manage Affiliated Entities</font></a><font size="1"> section of this document, specifically by setting the affiliation to &quot;member&quot;.</font></p></p></blockquote> <p>修正昨天说的。影响到PubSub External Component的应该有两种Access Model，就是上边所说的Presence和Roster。  <p>不过我实在不知道把Publish Subscribe Service做成一个External Component有多大好处。我之前只是简单觉得，可以把它放在另外一台电脑上运行，而且不一定局限于连接Openfire XMPP Server，以后过度期间还可以连到ejabber啊之类的XMPP Server。  <p>不过现在看来并不能简单得单一的作为一个External Component，因为一旦牵扯到Presence Subscription和Roster，就必须要相关的User data，而这些数据都储存在XMPP server上边，并不能是直接就可以想拿就拿来用的。  <p>也不可能直接调用数据库！首先太慢！其次Server不一定立刻存储数据到数据库。  <p>必须通过发送接收相应的XMPP packet来交换数据，实现数据同步。  <p>现在想的，如果要用External Component，首先要写一个Internal PacketInterceptor Plugin，监视所有的Presence subscription Packet。因为Openfire server api里边没有presence handler处理这种Packet：  <blockquote>
<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;font size="1" face="Verdana">&lt;presence to='juliet@example.com' type='subscribe'/&gt;&lt;/font></span></code></pre></td></tr></table></div></figure>
</blockquote>
<p>不过倒是有IQHandler专门可以用来处理Roster add and delete packet： 
<blockquote>
<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;font size="1" face="Verdana">&lt;iq from='juliet@example.com/balcony' type='set' id='roster_2'&gt;
</span><span class='line'>  &lt;query xmlns='jabber:iq:roster'&gt;
</span><span class='line'>    &lt;item jid='nurse@example.com'
</span><span class='line'>          name='Nurse'&gt;
</span><span class='line'>      &lt;group&gt;Servants&lt;/group&gt;
</span><span class='line'>    &lt;/item&gt;
</span><span class='line'>  &lt;/query&gt;
</span><span class='line'>&lt;/iq&gt;&lt;/font></span></code></pre></td></tr></table></div></figure>
</blockquote>
<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;font face="Verdana">所以同步Roster和Presence Subscription还是可以实现的，当然External Publish Subscribe component也就可以实现了。&lt;/font></span></code></pre></td></tr></table></div></figure>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;font face="Verdana">只是不知道最后会不会太慢。&lt;/font></span></code></pre></td></tr></table></div></figure>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;font face="Verdana">如果不用External Component，那就简单了，之前写的东西，修改一下，就可以用了。&lt;/font></span></code></pre></td></tr></table></div></figure>
  </p></p></p></div>

</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Liy</span></span>

      








  


<time datetime="2009-03-25T00:00:00+00:00" pubdate data-updated="true">Mar 25<span>th</span>, 2009</time>
      


    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://aircapsule.com/blogs/9" data-via="" data-counturl="http://aircapsule.com/blogs/9" >Tweet</a>
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blogs/10" title="Previous Post: 麻烦的External Component Roster Access问题">&laquo; 麻烦的External Component Roster Access问题</a>
      
      
        <a class="basic-alignment right" href="/blogs/8" title="Next Post: 跩圆了！">跩圆了！ &raquo;</a>
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2013/03/13/mandelbrot-set-and-webgl/">Mandelbrot set and WebGL</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/03/04/zhun-bei-life-in-uk-kao-shi-zhong/">准备 Life in UK 考试中</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/03/02/migrate-to-github-pages/">Migrate to github pages</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/01/29/mang-a/">忙啊</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/01/29/first-post/">First post</a>
      </li>
    
  </ul>
</section>






  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2013 - Liy -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'aircapsule';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://aircapsule.com/blogs/9';
        var disqus_url = 'http://aircapsule.com/blogs/9';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
